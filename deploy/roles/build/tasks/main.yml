- name: Check if Node.js is installed
  ansible.builtin.command:
    cmd: node --version
  register: node_check
  ignore_errors: true
  changed_when: false


- name: Install Node.js (if not present)
  ansible.builtin.fail:
    msg: "Node.js is not installed. Please install Node.js 18 or higher."
  when: node_check.rc != 0


- name: Install npm dependencies
  ansible.builtin.command:
    cmd: npm install
    chdir: "{{ playbook_dir }}/.."
  args:
    creates: "{{ playbook_dir }}/../node_modules"


- name: Remove old build
  ansible.builtin.file:
    path: "{{ playbook_dir }}/../build"
    state: absent


- name: Build Docusaurus site
  ansible.builtin.command:
    cmd: npm run build
    chdir: "{{ playbook_dir }}/.."
  register: docusaurus_build
  changed_when: true
