"use strict";(self.webpackChunksemaphore_docs=self.webpackChunksemaphore_docs||[]).push([[4305],{3196:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"administration-guide/installation/docker","title":"docker","description":"Installation","source":"@site/docs/administration-guide/installation/docker.md","sourceDirName":"administration-guide/installation","slug":"/administration-guide/installation/docker","permalink":"/administration-guide/installation/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/semaphoreui/semaphore-docs/edit/main/docs/administration-guide/installation/docker.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"package-manager","permalink":"/administration-guide/installation/package-manager"},"next":{"title":"Cloud deployment","permalink":"/administration-guide/installation/cloud"}}');var o=s(4848),r=s(8453);const a={},i="Docker",l={},c=[{value:"Installing Additional Python Dependencies",id:"installing-additional-python-dependencies",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{class:"breadcrumbs",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)("a",{href:"/administration-guide/installation",children:"Installation"}),"\n\u2192 Docker"]})}),"\n",(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"docker",children:"Docker"})}),"\n",(0,o.jsxs)(n.p,{children:[" Create a ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," file with following content:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  # uncomment this section and comment out the mysql section to use postgres instead of mysql\n  #postgres:\n    #restart: unless-stopped\n    #image: postgres:14\n    #hostname: postgres\n    #volumes:\n    #  - semaphore-postgres:/var/lib/postgresql/data\n    #environment:\n    #  POSTGRES_USER: semaphore\n    #  POSTGRES_PASSWORD: semaphore\n    #  POSTGRES_DB: semaphore\n  # if you wish to use postgres, comment the mysql service section below\n  mysql:\n    restart: unless-stopped\n    image: mysql:8.0\n    hostname: mysql\n    volumes:\n      - semaphore-mysql:/var/lib/mysql\n    environment:\n      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'\n      MYSQL_DATABASE: semaphore\n      MYSQL_USER: semaphore\n      MYSQL_PASSWORD: semaphore\n  semaphore:\n    restart: unless-stopped\n    ports:\n      - 3000:3000\n    image: semaphoreui/semaphore:latest\n    environment:\n      SEMAPHORE_DB_USER: semaphore\n      SEMAPHORE_DB_PASS: semaphore\n      SEMAPHORE_DB_HOST: mysql # for postgres, change to: postgres\n      SEMAPHORE_DB_PORT: 3306 # change to 5432 for postgres\n      SEMAPHORE_DB_DIALECT: mysql # for postgres, change to: postgres\n      SEMAPHORE_DB: semaphore\n      # To use SQLite instead of MySQL/Postgres (v2.16+)\n      # SEMAPHORE_DB_DIALECT: sqlite\n      # SEMAPHORE_DB: \"/etc/semaphore/semaphore.sqlite\"\n      SEMAPHORE_PLAYBOOK_PATH: /tmp/semaphore/\n      SEMAPHORE_ADMIN_PASSWORD: changeme\n      SEMAPHORE_ADMIN_NAME: admin\n      SEMAPHORE_ADMIN_EMAIL: admin@localhost\n      SEMAPHORE_ADMIN: admin\n      SEMAPHORE_ACCESS_KEY_ENCRYPTION: gs72mPntFATGJs9qK0pQ0rKtfidlexiMjYCH9gWKhTU=\n      SEMAPHORE_LDAP_ACTIVATED: 'no' # if you wish to use ldap, set to: 'yes'\n      SEMAPHORE_LDAP_HOST: dc01.local.example.com\n      SEMAPHORE_LDAP_PORT: '636'\n      SEMAPHORE_LDAP_NEEDTLS: 'yes'\n      SEMAPHORE_LDAP_DN_BIND: 'uid=bind_user,cn=users,cn=accounts,dc=local,dc=shiftsystems,dc=net'\n      SEMAPHORE_LDAP_PASSWORD: 'ldap_bind_account_password'\n      SEMAPHORE_LDAP_DN_SEARCH: 'dc=local,dc=example,dc=com'\n      SEMAPHORE_LDAP_SEARCH_FILTER: \"(\\u0026(uid=%s)(memberOf=cn=ipausers,cn=groups,cn=accounts,dc=local,dc=example,dc=com))\"\n      TZ: UTC\n    depends_on:\n      - mysql # for postgres, change to: postgres\nvolumes:\n  semaphore-mysql: # to use postgres, switch to: semaphore-postgres\n"})}),"\n",(0,o.jsx)(n.p,{children:"You must specify following confidential variables:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"MYSQL_PASSWORD"})," and ",(0,o.jsx)(n.code,{children:"SEMAPHORE_DB_PASS"})," \u2014 password for the MySQL user."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SEMAPHORE_ADMIN_PASSWORD"})," \u2014 password for the Semaphore's admin user."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"SEMAPHORE_ACCESS_KEY_ENCRYPTION"})," \u2014 key for encrypting access keys in database. It must be generated by using the following command: ",(0,o.jsx)(n.code,{children:"head -c32 /dev/urandom | base64"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you are using Docker Swarm, it is strongly recommended that you don't embed credentials directly in the Compose file (nor in environment variables generally) and instead use ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/engine/swarm/secrets/",children:"Docker Secrets"}),". Semaphore ",(0,o.jsx)(n.a,{href:"https://github.com/semaphoreui/semaphore/issues/1268",children:"supports"})," a common Docker container pattern for retrieving settings from files instead of the environment by appending ",(0,o.jsx)(n.code,{children:"_FILE"})," to the end of the environment variable name. See the ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/engine/swarm/secrets/#use-secrets-in-compose",children:"Docker documentation for an example"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"A limited example using secrets:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"secrets:\n  semaphore_admin_pw:\n    file: semaphore_admin_password.txt\n\nservices:\n  semaphore:\n    restart: unless-stopped\n    ports:\n      - 3000:3000\n    image: semaphoreui/semaphore:latest\n    environment:\n      SEMAPHORE_ADMIN_PASSWORD_FILE: /run/secrets/semaphore_admin_pw\n      SEMAPHORE_ADMIN_NAME: admin\n      SEMAPHORE_ADMIN_EMAIL: admin@localhost\n      SEMAPHORE_ADMIN: admin\n"})}),"\n",(0,o.jsx)(n.p,{children:"Run the following command to start Semaphore with configured database (MySQL or Postgres):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker-compose up\n"})}),"\n",(0,o.jsxs)(n.p,{children:[" Semaphore will be available via the following URL ",(0,o.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"installing-additional-python-dependencies",children:"Installing Additional Python Dependencies"}),"\n",(0,o.jsx)(n.p,{children:"When the Semaphore container starts, it can automatically install additional Python packages that you may need for your Ansible playbooks. To use this feature:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Create a ",(0,o.jsx)(n.code,{children:"requirements.txt"})," file with your Python dependencies"]}),"\n",(0,o.jsxs)(n.li,{children:["Mount this file to the container at the path specified by ",(0,o.jsx)(n.code,{children:"SEMAPHORE_CONFIG_PATH"})," (defaults to ",(0,o.jsx)(n.code,{children:"/etc/semaphore"}),")"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Example update to your ",(0,o.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  semaphore:\n    restart: unless-stopped\n    ports:\n      - 3000:3000\n    image: semaphoreui/semaphore:latest\n    volumes:\n      - ./requirements.txt:/etc/semaphore/requirements.txt\n"})}),"\n",(0,o.jsxs)(n.p,{children:["During container startup, Semaphore will detect the ",(0,o.jsx)(n.code,{children:"requirements.txt"})," file and automatically run ",(0,o.jsx)(n.code,{children:"pip3 install --upgrade -r ${SEMAPHORE_CONFIG_PATH}/requirements.txt"})," to install the specified packages."]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>i});var t=s(6540);const o={},r=t.createContext(o);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);