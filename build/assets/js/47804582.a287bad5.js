"use strict";(self.webpackChunksemaphore_docs=self.webpackChunksemaphore_docs||[]).push([[3775],{1017:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"administration-guide/installation_manually","title":"Manually installing Semaphore","description":"----","source":"@site/docs/administration-guide/installation_manually.md","sourceDirName":"administration-guide","slug":"/administration-guide/installation_manually","permalink":"/administration-guide/installation_manually","draft":false,"unlisted":false,"editUrl":"https://github.com/semaphoreui/semaphore-docs/edit/main/docs/administration-guide/installation_manually.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"snap","permalink":"/administration-guide/installation/snap"},"next":{"title":"Configuration","permalink":"/administration-guide/configuration"}}');var l=s(4848),r=s(8453);const t={},a="Manually installing Semaphore",o={},h=[{value:"Service User",id:"service-user",level:2},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Python3",id:"python3",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Modules in user context",id:"modules-in-user-context",level:3},{value:"Modules in a virtualenv",id:"modules-in-a-virtualenv",level:3},{value:"Troubleshooting",id:"troubleshooting-1",level:4},{value:"Ansible Collections &amp; Roles",id:"ansible-collections--roles",level:2},{value:"Requirements",id:"requirements-1",level:3},{value:"Install in user-context",id:"install-in-user-context",level:3},{value:"Install when using a virtualenv",id:"install-when-using-a-virtualenv",level:3},{value:"Reverse Proxy",id:"reverse-proxy",level:2},{value:"Extended Systemd Service",id:"extended-systemd-service",level:2},{value:"Base",id:"base",level:3},{value:"Service user",id:"service-user-1",level:3},{value:"Python Modules",id:"python-modules",level:3},{value:"In user-context",id:"in-user-context",level:4},{value:"In virtualenv",id:"in-virtualenv",level:4},{value:"Ansible Collections &amp; Roles",id:"ansible-collections--roles-1",level:3},{value:"If using Python3 in user-context",id:"if-using-python3-in-user-context",level:4},{value:"If using Python3 in virtualenv",id:"if-using-python3-in-virtualenv",level:4},{value:"Other use-cases",id:"other-use-cases",level:3},{value:"Using local MariaDB",id:"using-local-mariadb",level:4},{value:"Using local Nginx",id:"using-local-nginx",level:4},{value:"Sending logs to syslog",id:"sending-logs-to-syslog",level:4},{value:"Full Examples",id:"full-examples",level:3},{value:"Python Modules in user-context",id:"python-modules-in-user-context",level:4},{value:"Python Modules in virtualenv",id:"python-modules-in-virtualenv",level:4},{value:"Fixes",id:"fixes",level:3},{value:"Troubleshooting",id:"troubleshooting-2",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"manually-installing-semaphore",children:"Manually installing Semaphore"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Content:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#service-user",children:"Service User"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#python3",children:"Python3"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#ansible-collections--roles",children:"Ansible Collections & Roles"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#reverse-proxy",children:"Reverse Proxy"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#extended-systemd-service",children:"Systemd Service"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation_manually#troubleshooting",children:"Troubleshooting"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"This documentation goes into the details on how to set-up Semaphore when using these installation methods:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation#package-manager",children:"Package manager"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/administration-guide/installation#binary-file",children:"Binary file"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The Semaphore software-package is just a part of the whole system needed to successfully run Ansible with it."}),"\n",(0,l.jsx)(n.p,{children:"The Python3- and Ansible-Execution-Environment are also very important!"}),"\n",(0,l.jsxs)(n.p,{children:["NOTE: There are ",(0,l.jsx)(n.a,{href:"https://galaxy.ansible.com/search?deprecated=false&keywords=ansible%20semaphore&order_by=-relevance&page=1",children:"existing Ansible-Galaxy Roles"})," that handle this setup-logic for you or can be used as a base-template for your own Ansible Role!"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"service-user",children:"Service User"}),"\n",(0,l.jsxs)(n.p,{children:["Semaphore does not need to be run as user ",(0,l.jsx)(n.code,{children:"root"})," - so you shouldn't."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Benefits"})," of using a service user:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Has its own user-config"}),"\n",(0,l.jsx)(n.li,{children:"Has its own environment"}),"\n",(0,l.jsx)(n.li,{children:"Processes easily identifiable"}),"\n",(0,l.jsx)(n.li,{children:"Gained system security"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["You can create a system user either manually by using ",(0,l.jsx)(n.code,{children:"adduser"})," or using the ",(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html",children:"ansible.builtin.user"})," module."]}),"\n",(0,l.jsx)(n.p,{children:"In this documentation we will assume:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["the service user creates is named ",(0,l.jsx)(n.code,{children:"semaphore"})]}),"\n",(0,l.jsxs)(n.li,{children:["it has the shell ",(0,l.jsx)(n.code,{children:"/bin/bash"})," set"]}),"\n",(0,l.jsxs)(n.li,{children:["its home directory is ",(0,l.jsx)(n.code,{children:"/home/semaphore"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.p,{children:"If the Ansible execution of Semaphore is failing - you will need to troubleshoot it in the context of the service user."}),"\n",(0,l.jsx)(n.p,{children:"You have multiple options to do so:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Change your whole shell session to be in the user's context:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Run a single command in the user's context:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo --login -u semaphore <command>\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"python3",children:"Python3"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/getting_started/index.html",children:"Ansible"})," is build using the ",(0,l.jsx)(n.a,{href:"https://docs.python.org/3/",children:"Python3"})," programming language."]}),"\n",(0,l.jsx)(n.p,{children:"So its clean setup is essential for Ansible to work correctly."}),"\n",(0,l.jsxs)(n.p,{children:["First - make sure the packages ",(0,l.jsx)(n.code,{children:"python3"})," and ",(0,l.jsx)(n.code,{children:"python3-pip"})," are installed on your system!"]}),"\n",(0,l.jsx)(n.p,{children:"You have multiple options to install required Python modules:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Installing them in the service user's context"}),"\n",(0,l.jsxs)(n.li,{children:["Installing them in a service-specific ",(0,l.jsx)(n.a,{href:"https://virtualenv.pypa.io/en/latest/",children:"Virtual Environment"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,l.jsxs)(n.p,{children:["Either way - it is recommended to use a ",(0,l.jsx)(n.code,{children:"requirements.txt"})," file to specify the modules that need to be installed."]}),"\n",(0,l.jsxs)(n.p,{children:["We will assume the file ",(0,l.jsx)(n.code,{children:"/home/semaphore/requirements.txt"})," is used."]}),"\n",(0,l.jsx)(n.p,{children:"Here is an example of its content:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"ansible\n# for common jinja-filters\nnetaddr\njmespath\n# for common modules\npywinrm\npasslib\nrequests\ndocker\n"})}),"\n",(0,l.jsx)(n.p,{children:"NOTE: You should also update those requirements from time to time!"}),"\n",(0,l.jsx)(n.p,{children:"An option for doing this automatically is also shown in the service example below."}),"\n",(0,l.jsx)(n.h3,{id:"modules-in-user-context",children:"Modules in user context"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Manually"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo --login -u semaphore python3 -m pip install --user --upgrade -r /home/semaphore/requirements.txt\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Using Ansible"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"- name: Install requirements\n  ansible.builtin.pip:\n    requirements: '/home/semaphore/requirements.txt'\n    extra_args: '--user --upgrade'\n  become_user: 'semaphore'\n"})}),"\n",(0,l.jsx)(n.h3,{id:"modules-in-a-virtualenv",children:"Modules in a virtualenv"}),"\n",(0,l.jsxs)(n.p,{children:["We will assume the virtualenv is created at ",(0,l.jsx)(n.code,{children:"/home/semaphore/venv"})]}),"\n",(0,l.jsx)(n.p,{children:"Make sure the virtual environment is activated inside the Service! This is also shown in the service example below."}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Manually"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\npython3 -m pip install --user virtualenv\npython3 -m venv /home/semaphore/venv\n# activate the context of the virtual environment\nsource /home/semaphore/venv/bin/activate\n# verify we are using python3 from inside the venv\nwhich python3\n> /home/semaphore/venv/bin/python3\npython3 -m pip install --upgrade -r /home/semaphore/requirements.txt\n# disable the context to the virtual environment\ndeactivate\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Using Ansible"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"- name: Create virtual environment and install requirements into it\n  ansible.builtin.pip:\n    requirements: '/home/semaphore/requirements.txt'\n    virtualenv: '/home/semaphore/venv'\n    state: present  # or 'latest' to upgrade the requirements\n"})}),"\n",(0,l.jsx)(n.h4,{id:"troubleshooting-1",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.p,{children:"If you encounter Python3 issues when using a virtual environment, you will need to change into its context to troubleshoot them:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\nsource /home/semaphore/venv/bin/activate\n# verify we are using python3 from inside the venv\nwhich python3\n> /home/semaphore/venv/bin/python3\n\n# troubleshooting\n\ndeactivate\n"})}),"\n",(0,l.jsx)(n.p,{children:"Sometimes a virtual environment also breaks on system upgrades. If this happens you might just remove the existing one and re-create it."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"ansible-collections--roles",children:"Ansible Collections & Roles"}),"\n",(0,l.jsx)(n.p,{children:"You might want to pre-install Ansible modules and roles, so they don't need to be installed every time a task runs!"}),"\n",(0,l.jsx)(n.h3,{id:"requirements-1",children:"Requirements"}),"\n",(0,l.jsxs)(n.p,{children:["It is recommended to use a ",(0,l.jsx)(n.code,{children:"requirements.yml"})," file to specify the modules that need to be installed."]}),"\n",(0,l.jsxs)(n.p,{children:["We will assume the file ",(0,l.jsx)(n.code,{children:"/home/semaphore/requirements.yml"})," is used."]}),"\n",(0,l.jsx)(n.p,{children:"Here is an example of its content:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n\ncollections:\n  - 'namespace.collection'\n  # for common collections:\n  - 'community.general'\n  - 'ansible.posix'\n  - 'community.mysql'\n  - 'community.crypto'\n\nroles:\n  - src: 'namespace.role'\n"})}),"\n",(0,l.jsxs)(n.p,{children:["See also: ",(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#installing-a-collection-from-galaxy",children:"Installing Collections"}),", ",(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#installing-multiple-roles-from-a-file",children:"Installing Roles"})]}),"\n",(0,l.jsx)(n.p,{children:"NOTE: You should also update those requirements from time to time!"}),"\n",(0,l.jsx)(n.p,{children:"An option for doing this automatically is also shown in the service example below."}),"\n",(0,l.jsx)(n.h3,{id:"install-in-user-context",children:"Install in user-context"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Manually"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\nansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml\nansible-galaxy role install --force -r /home/semaphore/requirements.yml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"install-when-using-a-virtualenv",children:"Install when using a virtualenv"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Manually"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\nsource /home/semaphore/venv/bin/activate\n# verify we are using python3 from inside the venv\nwhich python3\n> /home/semaphore/venv/bin/python3\n\nansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml\nansible-galaxy role install --force -r /home/semaphore/requirements.yml\n\ndeactivate\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"reverse-proxy",children:"Reverse Proxy"}),"\n",(0,l.jsxs)(n.p,{children:["See: ",(0,l.jsx)(n.a,{href:"/administration-guide/security#reverse-proxy",children:"Security - Encrypted connection"})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"extended-systemd-service",children:"Extended Systemd Service"}),"\n",(0,l.jsx)(n.p,{children:"Here is the basic template of the systemd service."}),"\n",(0,l.jsxs)(n.p,{children:["Add additional settings under their ",(0,l.jsx)(n.code,{children:"[PART]"})]}),"\n",(0,l.jsx)(n.h3,{id:"base",children:"Base"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=Semaphore UI\nDocumentation=https://docs.semaphoreui.com/\nWants=network-online.target\nAfter=network-online.target\nConditionPathExists=/usr/bin/semaphore\nConditionPathExists=/etc/semaphore/config.json\n\n[Service]\nExecStart=/usr/bin/semaphore server --config /etc/semaphore/config.json\nExecReload=/bin/kill -HUP $MAINPID\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,l.jsx)(n.h3,{id:"service-user-1",children:"Service user"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Service]\nUser=semaphore\nGroup=semaphore\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"python-modules",children:"Python Modules"}),"\n",(0,l.jsx)(n.h4,{id:"in-user-context",children:"In user-context"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[Service]\n# to auto-upgrade python modules at service startup\nExecStartPre=/bin/bash -c \'python3 -m pip install --upgrade --user -r /home/semaphore/requirements.txt\'\n\n# so the executables are found\nEnvironment="PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/semaphore/.local/bin"\n# set the correct python path. You can get the correct path with: python3 -c "import site; print(site.USER_SITE)" \nEnvironment="PYTHONPATH=/home/semaphore/.local/lib/python3.10/site-packages"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"in-virtualenv",children:"In virtualenv"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Service]\n# to auto-upgrade python modules at service startup\nExecStartPre=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                           && python3 -m pip install --upgrade -r /home/semaphore/requirements.txt'\n\n# REPLACE THE EXISTING 'ExecStart'\nExecStart=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                        && /usr/bin/semaphore server --config /etc/semaphore/config.json'\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"ansible-collections--roles-1",children:"Ansible Collections & Roles"}),"\n",(0,l.jsx)(n.h4,{id:"if-using-python3-in-user-context",children:"If using Python3 in user-context"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Service]\n# to auto-upgrade ansible collections and roles at service startup\nExecStartPre=/bin/bash -c 'ansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml'\nExecStartPre=/bin/bash -c 'ansible-galaxy role install --force -r /home/semaphore/requirements.yml'\n"})}),"\n",(0,l.jsx)(n.h4,{id:"if-using-python3-in-virtualenv",children:"If using Python3 in virtualenv"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"# to auto-upgrade ansible collections and roles at service startup\nExecStartPre=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                           && ansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml \\\n                           && ansible-galaxy role install --force -r /home/semaphore/requirements.yml'\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"other-use-cases",children:"Other use-cases"}),"\n",(0,l.jsx)(n.h4,{id:"using-local-mariadb",children:"Using local MariaDB"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Unit]\nRequires=mariadb.service\n"})}),"\n",(0,l.jsx)(n.h4,{id:"using-local-nginx",children:"Using local Nginx"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Unit]\nWants=nginx.service\n"})}),"\n",(0,l.jsx)(n.h4,{id:"sending-logs-to-syslog",children:"Sending logs to syslog"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Service]\nStandardOutput=journal\nStandardError=journal\nSyslogIdentifier=semaphore\n"})}),"\n",(0,l.jsx)(n.h3,{id:"full-examples",children:"Full Examples"}),"\n",(0,l.jsx)(n.h4,{id:"python-modules-in-user-context",children:"Python Modules in user-context"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=Semaphore UI\nDocumentation=https://docs.semaphoreui.com/\nWants=network-online.target\nAfter=network-online.target\nConditionPathExists=/usr/bin/semaphore\nConditionPathExists=/etc/semaphore/config.json\n\n[Service]\nUser=semaphore\nGroup=semaphore\nRestart=always\nRestartSec=10s\nEnvironment=\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:~/.local/bin\"\n\nExecStartPre=/bin/bash -c 'ansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml'\nExecStartPre=/bin/bash -c 'ansible-galaxy role install --force -r /home/semaphore/requirements.yml'\nExecStartPre=/bin/bash -c 'python3 -m pip install --upgrade --user -r /home/semaphore/requirements.txt'\n\nExecStart=/usr/bin/semaphore server --config /etc/semaphore/config.json\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,l.jsx)(n.h4,{id:"python-modules-in-virtualenv",children:"Python Modules in virtualenv"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=Semaphore UI\nDocumentation=https://docs.semaphoreui.com/\nWants=network-online.target\nAfter=network-online.target\nConditionPathExists=/usr/bin/semaphore\nConditionPathExists=/etc/semaphore/config.json\n\n[Service]\nUser=semaphore\nGroup=semaphore\nRestart=always\nRestartSec=10s\n\nExecStartPre=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                           && python3 -m pip install --upgrade -r /home/semaphore/requirements.txt'\nExecStartPre=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                           && ansible-galaxy collection install --upgrade -r /home/semaphore/requirements.yml \\\n                           && ansible-galaxy role install --force -r /home/semaphore/requirements.yml'\n\nExecStart=/bin/bash -c 'source /home/semaphore/venv/bin/activate \\\n                        && /usr/bin/semaphore server --config /etc/semaphore/config.json'\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,l.jsx)(n.h3,{id:"fixes",children:"Fixes"}),"\n",(0,l.jsx)(n.p,{children:"If you have a custom system language set - you might run into problems that can be resoled by updating the associated environmental variables:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:'[Service]\nEnvironment=LANG="en_US.UTF-8"\nEnvironment=LC_ALL="en_US.UTF-8"\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting-2",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.p,{children:"If there is a problem while executing a task it might be an environmental issue with your setup - not an issue with Semaphore itself!"}),"\n",(0,l.jsx)(n.p,{children:"Please go through these steps to verify if the issue occurs outside Semaphore:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Change into the context of the user:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo su --login semaphore\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Change into the context of the virtualenv if you use one:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"source /home/semaphore/venv/bin/activate\n# verify we are using python3 from inside the venv\nwhich python3\n> /home/semaphore/venv/bin/python3\n\n# troubleshooting\n\ndeactivate\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Run the Ansible Playbook manually"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If it ",(0,l.jsx)(n.strong,{children:"fails"})," => there is an issue with your environment"]}),"\n",(0,l.jsxs)(n.li,{children:["If it ",(0,l.jsx)(n.strong,{children:"works"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Re-check your configuration inside Semaphore"}),"\n",(0,l.jsx)(n.li,{children:"It might be an issue with Semaphore"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(6540);const l={},r=i.createContext(l);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);