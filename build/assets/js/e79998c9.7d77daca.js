"use strict";(self.webpackChunksemaphore_docs=self.webpackChunksemaphore_docs||[]).push([[822],{4805:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"administration-guide/ldap","title":"LDAP configuration","description":"Configuration file contains the following LDAP parameters:","source":"@site/docs/administration-guide/ldap.md","sourceDirName":"administration-guide","slug":"/administration-guide/ldap","permalink":"/administration-guide/ldap","draft":false,"unlisted":false,"editUrl":"https://github.com/semaphoreui/semaphore-docs/edit/main/docs/administration-guide/ldap.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"migrations","permalink":"/administration-guide/cli/migrations"},"next":{"title":"OpenID","permalink":"/administration-guide/openid"}}');var r=d(4848),i=d(8453);const l={},c="LDAP configuration",o={},a=[{value:"*Claim expression",id:"claim-expression",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Example: Using OpenLDAP Server",id:"example-using-openldap-server",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ldap-configuration",children:"LDAP configuration"})}),"\n",(0,r.jsx)(n.p,{children:"Configuration file contains the following LDAP parameters:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ldap_binddn": "cn=admin,dc=example,dc=org",\n  "ldap_bindpassword": "admin_password",\n  "ldap_server": "localhost:389",\n  "ldap_searchdn": "ou=users,dc=example,dc=org",\n  "ldap_searchfilter": "(&(objectClass=inetOrgPerson)(uid=%s))",\n  "ldap_mappings": {\n    "dn": "",\n    "mail": "uid",\n    "uid": "uid",\n    "cn": "cn"\n  },\n  "ldap_enable": true,\n  "ldap_needtls": false,\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"All SSO provider options:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Environment Variables"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_binddn"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_BIND_DN"})}),(0,r.jsx)(n.td,{children:"Name of LDAP user object to bind."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_bindpassword"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_BIND_PASSWORD"})}),(0,r.jsx)(n.td,{children:"Password of LDAP user defined in Bind DN."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_server"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_SERVER"})}),(0,r.jsxs)(n.td,{children:["LDAP server host including port. For example: ",(0,r.jsx)(n.code,{children:"localhost:389"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_searchdn"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_SEARCH_DN"})}),(0,r.jsxs)(n.td,{children:["Scope where users will be searched. For example: ",(0,r.jsx)(n.code,{children:"ou=users,dc=example,dc=org"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_searchfilter"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_SEARCH_FILTER"})}),(0,r.jsxs)(n.td,{children:["Users search expression. Default: ",(0,r.jsx)(n.code,{children:"(&(objectClass=inetOrgPerson)(uid=%s))"}),", where ",(0,r.jsx)(n.code,{children:"%s"})," will replaced to entered login."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_mappings.dn"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_MAPPING_DN"})}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_mappings.mail"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_MAPPING_MAIL"})}),(0,r.jsxs)(n.td,{children:["User email claim expression",(0,r.jsx)(n.a,{href:"#claim-expression",children:"*"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_mappings.uid"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_MAPPING_UID"})}),(0,r.jsxs)(n.td,{children:["User login claim expression",(0,r.jsx)(n.a,{href:"#claim-expression",children:"*"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_mappings.cn"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_MAPPING_CN"})}),(0,r.jsxs)(n.td,{children:["User name claim expression",(0,r.jsx)(n.a,{href:"#claim-expression",children:"*"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_enable"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_ENABLE"})}),(0,r.jsx)(n.td,{children:"LDAP enabled."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ldap_needtls"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SEMAPHORE_LDAP_NEEDTLS"})}),(0,r.jsx)(n.td,{children:"Connect to LDAP server by SSL."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"claim-expression",children:"*Claim expression"}),"\n",(0,r.jsx)(n.p,{children:"Example of claim expression:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"email | {{ .username }}@your-domain.com\n"})}),"\n",(0,r.jsx)(n.p,{children:"Semaphore is attempting to claim the email field first. If it is empty, the expression following it is executed."}),"\n",(0,r.jsx)("div",{class:"warning",children:(0,r.jsxs)(n.p,{children:["The expression ",(0,r.jsx)("code",{children:'"username_claim": "|"'})," generates a random ",(0,r.jsx)("code",{children:"username"})," for each user who logs in through the provider."]})}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"ldapwhoami"})," tool to check if your ",(0,r.jsx)(n.strong,{children:"BindDN"})," works:\nThis tool is provided by the ",(0,r.jsx)(n.strong,{children:"openldap-clients"})," package."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ldapwhoami\\\n  -H ldap://ldap.com:389\\\n  -D "CN=your_ldap_binddn_value_in_config"\\\n  -x\\\n  -W\n'})}),"\n",(0,r.jsxs)(n.p,{children:["It will ask interactively for the password, and should return code ",(0,r.jsx)(n.strong,{children:"0"})," and echo out the ",(0,r.jsx)(n.strong,{children:"DN"})," as specified."]}),"\n",(0,r.jsx)("div",{class:"warning",children:(0,r.jsxs)(n.p,{children:["Please read ",(0,r.jsx)("a",{href:"../faq/troubleshooting.html#6-unable-to-read-ldap-response-packet-unexpected-eof",children:"Troubleshooting"})," section if you have issues with LDAP."]})}),"\n",(0,r.jsx)(n.h2,{id:"example-using-openldap-server",children:"Example: Using OpenLDAP Server"}),"\n",(0,r.jsx)(n.p,{children:"Run the following command to start your own LDAP server with an admin account and an additional user:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -d --name openldap \\\n  -p 1389:1389 \\\n  -p 1636:1636 \\\n  -e LDAP_ADMIN_USERNAME=admin \\\n  -e LDAP_ADMIN_PASSWORD=pwd \\\n  -e LDAP_USERS=user1 \\\n  -e LDAP_PASSWORDS=pwd \\\n  -e LDAP_ROOT=dc=example,dc=org \\\n  -e LDAP_ADMIN_DN=cn=admin,dc=example,dc=org \\\n  bitnami/openldap:latest\n"})}),"\n",(0,r.jsx)(n.p,{children:"Your LDAP configuration for Semaphore UI should be as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n\t"ldap_binddn": "cn=admin,dc=example,dc=org",\n\t"ldap_bindpassword": "pwd",\n\t"ldap_server": "ldap-server.com:1389",\n\t"ldap_searchdn": "dc=example,dc=org",\n\t"ldap_searchfilter": "(&(objectClass=inetOrgPerson)(uid=%s))",\n\t"ldap_mappings": {\n\t\t"mail": "{{ .cn }}@ldap.your-domain.com",\n\t\t"uid": "|",\n\t\t"cn": "cn"\n\t},\n\t"ldap_enable": true,\n\t"ldap_needtls": false\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"To run Semaphore in Docker, use the following LDAP configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker run -d -p 3000:3000 --name semaphore \\\n  -e SEMAPHORE_DB_DIALECT=bolt \\\n  -e SEMAPHORE_ADMIN=admin \\\n  -e SEMAPHORE_ADMIN_PASSWORD=changeme \\\n  -e SEMAPHORE_ADMIN_NAME=Admin \\\n  -e SEMAPHORE_ADMIN_EMAIL=admin@localhost \\\n  -e SEMAPHORE_LDAP_ENABLE=yes \\\n  -e SEMAPHORE_LDAP_SERVER=ldap-server.com:1389 \\\n  -e SEMAPHORE_LDAP_BIND_DN=cn=admin,dc=example,dc=org \\\n  -e SEMAPHORE_LDAP_BIND_PASSWORD=pwd \\\n  -e SEMAPHORE_LDAP_SEARCH_DN=dc=example,dc=org \\\n  -e 'SEMAPHORE_LDAP_SEARCH_FILTER=(&(objectClass=inetOrgPerson)(uid=%s))' \\\n  -e 'SEMAPHORE_LDAP_MAPPING_MAIL={{ .cn }}@ldap.your-domain.com' \\\n  -e 'SEMAPHORE_LDAP_MAPPING_UID=|' \\\n  -e 'SEMAPHORE_LDAP_MAPPING_CN=cn' \\\n  semaphoreui/semaphore:latest\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,d)=>{d.d(n,{R:()=>l,x:()=>c});var s=d(6540);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);